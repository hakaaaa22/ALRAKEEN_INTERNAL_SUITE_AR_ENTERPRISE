export function detectTampering(rows:any[]){ const issues:any[]=[]; const s=new Map(); const i=new Map(); rows.forEach((r,idx)=>{ const row=idx+2; const serial=String(r.serial||"").trim(); const imei=String(r.imei||"").trim(); if(serial){ if(s.has(serial)) issues.push({row,field:"serial",level:"error",msg:`Serial مكرر (موجود في صف ${s.get(serial)})`}); else s.set(serial,row);} if(imei){ if(i.has(imei)) issues.push({row,field:"imei",level:"error",msg:`IMEI مكرر (موجود في صف ${i.get(imei)})`}); else i.set(imei,row); if(!/^\d{14,16}$/.test(imei)) issues.push({row,field:"imei",level:"warn",msg:"IMEI غير مطابق"}); } }); return issues; }
